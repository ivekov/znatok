services:
  # Qdrant — векторная БД
  qdrant:
    image: qdrant/qdrant:v1.15
    container_name: znatok-qdrant
    ports:
      - "6333:6333"
    volumes:
      - qdrant_storage:/qdrant/storage

  # Бэкенд — FastAPI
  backend:
    build: ./backend
    container_name: znatok-backend
    env_file: .env
    ports:
      - "8000:8000"
    volumes:
      - ./backend/uploads:/app/uploads  # ← добавьте эту строку
      - huggingface_cache:/root/.cache/huggingface  # ← добавили эту строку
    depends_on:
      - qdrant
    networks:
      - znatok-network

  # Фронтенд + Nginx (единый сервис)
  web:
    build:
      context: .
      dockerfile: nginx/Dockerfile
    container_name: znatok-web
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - znatok-network

volumes:
  qdrant_storage:
  huggingface_cache:  # ← добавили этот volume

networks:
  znatok-network:
    driver: bridge